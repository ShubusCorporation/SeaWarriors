# –ê—É–¥–∏—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ SeaWarriors

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### 1. –î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å –≤ `getNumerator()` (–ö–†–ò–¢–ò–ß–ù–û)
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –°—Ç—Ä–æ–∫–∞ 115-118
```solidity
uint256 avg5p = avg / 20;
if (rem > avg5p) {
    uint256 coeff = rem * 5 / avg5p; // ‚ö†Ô∏è –î–ï–õ–ï–ù–ò–ï –ù–ê –ù–û–õ–¨ –µ—Å–ª–∏ avg < 20
}
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ `avg < 20`, —Ç–æ `avg5p = 0`, —á—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –¥–µ–ª–µ–Ω–∏—é –Ω–∞ –Ω–æ–ª—å –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ `coeff`.
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `require(avg5p > 0, "Division by zero")` –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É.

### 2. –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π/–º–∞–Ω–∏–ø—É–ª–∏—Ä—É–µ–º—ã–π random (–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –°—Ç—Ä–æ–∫–∞ 131-142
```solidity
function getRandom(uint256 N) private view returns (uint256) {
    uint256 randomHash = uint256(
        keccak256(
            abi.encodePacked(
                block.timestamp,  // ‚ö†Ô∏è –ú–∞–π–Ω–µ—Ä –º–æ–∂–µ—Ç –º–∞–Ω–∏–ø—É–ª–∏—Ä–æ–≤–∞—Ç—å
                msg.sender,
                block.prevrandao  // ‚ö†Ô∏è –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º
            )
        )
    );
    return randomHash % (N + 1);
}
```
**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –ú–∞–π–Ω–µ—Ä –º–æ–∂–µ—Ç –º–∞–Ω–∏–ø—É–ª–∏—Ä–æ–≤–∞—Ç—å `block.timestamp` –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –±–ª–æ–∫–∞
- `block.prevrandao` –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç front-run —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∑–Ω–∞—è `msg.sender`
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å commit-reveal —Å—Ö–µ–º—É –∏–ª–∏ Chainlink VRF –¥–ª—è –∏—Å—Ç–∏–Ω–Ω–æ–π —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏.

### 3. Front-running —É—è–∑–≤–∏–º–æ—Å—Ç—å (–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ mempool –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏ —Å –±–æ–ª—å—à–µ–π —Å—É–º–º–æ–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª—É—á—à–µ–≥–æ NFT.
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å commit-reveal —Å—Ö–µ–º—É –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏.

## üü° –ü–†–û–ë–õ–ï–ú–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò (–°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)

### 4. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ mapping
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –°—Ç—Ä–æ–∫–∞ 22
```solidity
mapping(uint256 => uint256) private _tokenIDTometadataId;
```
**–ü—Ä–æ–±–ª–µ–º–∞:** Mapping –æ–±—ä—è–≤–ª–µ–Ω, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è. –õ–∏–±–æ —É–¥–∞–ª–∏—Ç—å, –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è metadataId.

### 5. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç reentrancy
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –§—É–Ω–∫—Ü–∏—è `buy()`
**–ü—Ä–æ–±–ª–µ–º–∞:** –•–æ—Ç—è `_safeMint` –∑–∞—â–∏—â–µ–Ω, –ª—É—á—à–µ –¥–æ–±–∞–≤–∏—Ç—å explicit –∑–∞—â–∏—Ç—É.
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ReentrancyGuard –∏–∑ OpenZeppelin.

## ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–´ –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–ò –ì–ê–ó–ê

### 6. –î–≤–æ–π–Ω–æ–π —Ü–∏–∫–ª –≤ `getmetadataId()` (–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢)
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –°—Ç—Ä–æ–∫–∏ 85-100
**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –ü–µ—Ä–≤—ã–π —Ü–∏–∫–ª —Å–æ–∑–¥–∞–µ—Ç –º–∞—Å—Å–∏–≤ –∏ –≤—ã—á–∏—Å–ª—è–µ—Ç —Å—É–º–º—É
- –í—Ç–æ—Ä–æ–π —Ü–∏–∫–ª –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –º–∞—Å—Å–∏–≤—É –¥–ª—è –ø–æ–∏—Å–∫–∞
- –ú–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ –æ–¥–∏–Ω —Ü–∏–∫–ª, –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—è –≤–µ—Å—å –º–∞—Å—Å–∏–≤

**–¢–µ–∫—É—â–∏–π —Ä–∞—Å—Ö–æ–¥:** ~13 –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏ –≤ memory + 13 –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è
**–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π:** –¢–æ–ª—å–∫–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Å—Å–∏–≤–∞

### 7. –ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ memory –¥–ª—è –º–∞—Å—Å–∏–≤–∞
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –°—Ç—Ä–æ–∫–∞ 83
```solidity
uint256[TOTAL_PICTURES] memory arr;
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–∞—Å—Å–∏–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è, –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏—Å—å –±–µ–∑ –Ω–µ–≥–æ.

### 8. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã `_setTokenURI`
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –°—Ç—Ä–æ–∫–∏ 49, 68
**–ü—Ä–æ–±–ª–µ–º–∞:** `_setTokenURI` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ storage, —á—Ç–æ –¥–æ—Ä–æ–≥–æ –ø–æ –≥–∞–∑—É.
**–†–µ—à–µ–Ω–∏–µ:** –ï—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `_baseURI()` –≤–º–µ—Å—Ç–æ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö URI.

### 9. –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ `buy()`
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –°—Ç—Ä–æ–∫–∞ 61
```solidity
require(metadataId > 0 && metadataId <= TOTAL_PICTURES, InsufficientFunds());
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ü–û–°–õ–ï –≤—ã—á–∏—Å–ª–µ–Ω–∏—è `getmetadataId()`, –∫–æ—Ç–æ—Ä–æ–µ –¥–æ—Ä–æ–≥–æ–µ. –õ—É—á—à–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ä–∞–Ω—å—à–µ.

## üêõ –ü–†–û–ë–õ–ï–ú–´ –ö–û–†–†–ï–ö–¢–ù–û–°–¢–ò –ê–õ–ì–û–†–ò–¢–ú–ê

### 10. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ random
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –°—Ç—Ä–æ–∫–∞ 141
```solidity
return randomHash % (N + 1); // [0..N]
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ `random = 0`, —Ç–æ `currentSumm >= random` –±—É–¥–µ—Ç true –Ω–∞ –ø–µ—Ä–≤–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ.
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `randomHash % N + 1` –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞ [1..N] –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª—É—á–∞–π `random = 0`.

### 11. –õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ –≤–æ–∑–≤—Ä–∞—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –°—Ç—Ä–æ–∫–∞ 101
```solidity
return 1; // Fallback, –Ω–æ –∫–æ–≥–¥–∞ —ç—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç?
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ —Ü–∏–∫–ª –Ω–µ –Ω–∞—à–µ–ª –∑–Ω–∞—á–µ–Ω–∏–µ (—á—Ç–æ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ), –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 1. –ù–æ —ç—Ç–æ –º–æ–∂–µ—Ç —Å–∫—Ä—ã—Ç—å –±–∞–≥.

### 12. –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ–º –≤ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –°—Ç—Ä–æ–∫–∞ 86
```solidity
curr = curr * numerator / denominator;
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –±–æ–ª—å—à–∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö `curr * numerator` –º–æ–∂–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—å—Å—è –¥–æ –¥–µ–ª–µ–Ω–∏—è. –í Solidity 0.8+ —ç—Ç–æ –≤—ã–∑–æ–≤–µ—Ç revert.
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã.

### 13. –ù–µ—Ç–æ—á–Ω–æ—Å—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∏–∑-–∑–∞ —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–π –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –¥–µ–ª–µ–Ω–∏–∏.
**–ü—Ä–∏–º–µ—Ä:** `curr * numerator / denominator` –º–æ–∂–µ—Ç –¥–∞—Ç—å –Ω–µ—Ç–æ—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

## üìä –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### 14. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤–µ—Ä—Å–∏–π Solidity
**–ü—Ä–æ–±–ª–µ–º–∞:** 
- `src/SeaWarriors.sol` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `0.8.30`
- `test/SeaWarriors.t.sol` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `^0.8.27`
**–†–µ—à–µ–Ω–∏–µ:** –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏–∏.

### 15. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–Ω—Ç—Ä–∞–∫—Ç –ø–æ–ª—É—á–∞–µ—Ç ETH —á–µ—Ä–µ–∑ `buy()`, –Ω–æ –Ω–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ –≤–ª–∞–¥–µ–ª—å—Ü–µ–º.
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å `withdraw()` —Ñ—É–Ω–∫—Ü–∏—é.

### 16. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –≤–∞–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø–æ–∫—É–ø–æ–∫, —á—Ç–æ –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ.
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏—è `Purchase(address indexed buyer, uint256 tokenId, uint256 amount, uint256 metadataId)`.

## ‚úÖ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ):
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å –≤ `getNumerator()`
2. –£–ª—É—á—à–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Chainlink VRF –∏–ª–∏ commit-reveal)
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å `getmetadataId()` - —É–±—Ä–∞—Ç—å –¥–≤–æ–π–Ω–æ–π —Ü–∏–∫–ª

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ):
4. –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `withdraw()` –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤
5. –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
6. –î–æ–±–∞–≤–∏—Ç—å ReentrancyGuard
7. –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏–∏ Solidity

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ):
8. –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ mapping –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ
9. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ —Ç–µ—Å—Ç–æ–≤
10. –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∫ —Ñ—É–Ω–∫—Ü–∏—è–º





